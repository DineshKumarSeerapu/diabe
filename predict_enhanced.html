{% extends "base.html" %}

{% block title %}EDL Diabetes Risk Assessment - Advanced Analysis{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title"><i class="fas fa-brain"></i> Ensemble Deep Learning Diabetes Assessment</h2>
        <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
            Advanced multi-model AI system achieving <strong>98.82% accuracy</strong> with clinical-grade predictions
        </p>
    </div>
    
    <!-- Model Selection -->
    <div style="margin-bottom: 2rem;">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button class="model-selector active" onclick="showModel('ddfh')" id="ddfh-btn">
                <i class="fas fa-hospital"></i> DDFH Clinical Model
                <small>3-Class: No/Pre/Diabetes</small>
            </button>
            <button class="model-selector" onclick="showModel('pima')" id="pima-btn">
                <i class="fas fa-chart-line"></i> PIMA Standard Model  
                <small>Binary: Low/High Risk</small>
            </button>
        </div>
    </div>

    <!-- DDFH Model Form -->
    <div id="ddfh-form" class="model-form">
        <div style="background: linear-gradient(135deg, #e6f3ff, #cce7ff); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-award"></i> DDFH Clinical Model (98.82% Accuracy)
            </h4>
            <p style="margin: 0;">Advanced 3-class classification: <strong>No Diabetes</strong>, <strong>Pre-Diabetes</strong>, <strong>Diabetes</strong></p>
        </div>

        <form method="POST" class="prediction-form">
            <input type="hidden" name="prediction_type" value="ddfh">
            
            <div class="form-group">
                <label for="hba1c" class="form-label">
                    <i class="fas fa-tint" style="color: #e53e3e;"></i> HbA1c (%) - Primary Indicator
                </label>
                <input type="number" id="hba1c" name="hba1c" class="form-control" min="3" max="15" step="0.1" placeholder="5.5" required>
                <small style="color: var(--text-secondary);">
                    Normal: <4.0% | Pre-diabetes: 5.7-6.4% | Diabetes: ≥6.5%
                </small>
            </div>

            <div class="form-group">
                <label for="bmi_enhanced" class="form-label">
                    <i class="fas fa-weight" style="color: #3182ce;"></i> Body Mass Index (BMI)
                </label>
                <input type="number" id="bmi_enhanced" name="bmi" class="form-control" min="15" max="50" step="0.1" placeholder="25.0" required>
                <small style="color: var(--text-secondary);">Normal: 18.5-24.9 | Overweight: 25-29.9 | Obese: ≥30</small>
            </div>

            <div class="form-group">
                <label for="age_enhanced" class="form-label">
                    <i class="fas fa-calendar-alt" style="color: #805ad5;"></i> Age (years)
                </label>
                <input type="number" id="age_enhanced" name="age" class="form-control" min="18" max="100" placeholder="45" required>
                <small style="color: var(--text-secondary);">Higher age increases diabetes risk</small>
            </div>

            <div class="form-group">
                <label for="tg" class="form-label">
                    <i class="fas fa-flask" style="color: #38a169;"></i> Triglycerides (mg/dL)
                </label>
                <input type="number" id="tg" name="tg" class="form-control" min="50" max="500" step="1" placeholder="150" required>
                <small style="color: var(--text-secondary);">Normal: <150 mg/dL | High: ≥200 mg/dL</small>
            </div>

            <div class="form-group">
                <label for="gender" class="form-label">
                    <i class="fas fa-venus-mars" style="color: #d69e2e;"></i> Gender
                </label>
                <select id="gender" name="gender" class="form-control" required>
                    <option value="">Select Gender</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                </select>
                <small style="color: var(--text-secondary);">Gender affects diabetes risk patterns</small>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button type="submit" class="btn btn-primary" style="padding: 1rem 3rem; font-size: 1.1rem;">
                    <i class="fas fa-brain"></i> AI Analysis (EDL System)
                </button>
            </div>
        </form>
    </div>

    <!-- PIMA Model Form -->
    <div id="pima-form" class="model-form" style="display: none;">
        <div style="background: linear-gradient(135deg, #f0fff4, #c6f6d5); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-chart-line"></i> PIMA Standard Model
            </h4>
            <p style="margin: 0;">Binary classification: <strong>Low Risk</strong> vs <strong>High Risk</strong> for diabetes</p>
        </div>

        <form method="POST" class="prediction-form">
            <input type="hidden" name="prediction_type" value="pima">
            
            <div class="form-group">
                <label for="pregnancies" class="form-label">
                    <i class="fas fa-baby"></i> Number of Pregnancies
                </label>
                <input type="number" id="pregnancies" name="pregnancies" class="form-control" min="0" max="17" value="0" required>
                <small style="color: var(--text-secondary);">Total number of pregnancies (0 if none)</small>
            </div>

            <div class="form-group">
                <label for="glucose" class="form-label">
                    <i class="fas fa-tint"></i> Glucose Level (mg/dL)
                </label>
                <input type="number" id="glucose" name="glucose" class="form-control" min="0" max="300" step="0.1" placeholder="120" required>
                <small style="color: var(--text-secondary);">Blood glucose level (normal: 70-140 mg/dL)</small>
            </div>

            <div class="form-group">
                <label for="blood_pressure" class="form-label">
                    <i class="fas fa-heartbeat"></i> Blood Pressure (mmHg)
                </label>
                <input type="number" id="blood_pressure" name="blood_pressure" class="form-control" min="0" max="200" step="0.1" placeholder="80" required>
                <small style="color: var(--text-secondary);">Diastolic blood pressure (normal: 60-80 mmHg)</small>
            </div>

            <div class="form-group">
                <label for="skin_thickness" class="form-label">
                    <i class="fas fa-ruler"></i> Skin Thickness (mm)
                </label>
                <input type="number" id="skin_thickness" name="skin_thickness" class="form-control" min="0" max="100" step="0.1" placeholder="20" required>
                <small style="color: var(--text-secondary);">Triceps skin fold thickness (normal: 10-40 mm)</small>
            </div>

            <div class="form-group">
                <label for="insulin" class="form-label">
                    <i class="fas fa-syringe"></i> Insulin Level (mu U/ml)
                </label>
                <input type="number" id="insulin" name="insulin" class="form-control" min="0" max="900" step="0.1" placeholder="80" required>
                <small style="color: var(--text-secondary);">Serum insulin level (normal: 16-166 mu U/ml)</small>
            </div>

            <div class="form-group">
                <label for="bmi" class="form-label">
                    <i class="fas fa-weight"></i> Body Mass Index (BMI)
                </label>
                <input type="number" id="bmi" name="bmi" class="form-control" min="10" max="70" step="0.1" placeholder="25.0" required>
                <small style="color: var(--text-secondary);">Weight in kg / (height in meters)² (normal: 18.5-24.9)</small>
            </div>

            <div class="form-group">
                <label for="diabetes_pedigree" class="form-label">
                    <i class="fas fa-dna"></i> Diabetes Pedigree Function
                </label>
                <input type="number" id="diabetes_pedigree" name="diabetes_pedigree" class="form-control" min="0" max="3" step="0.001" placeholder="0.5" required>
                <small style="color: var(--text-secondary);">Family history factor (0.078-2.42, higher = more family history)</small>
            </div>

            <div class="form-group">
                <label for="age" class="form-label">
                    <i class="fas fa-calendar-alt"></i> Age (years)
                </label>
                <input type="number" id="age" name="age" class="form-control" min="18" max="120" placeholder="30" required>
                <small style="color: var(--text-secondary);">Your current age in years</small>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button type="submit" class="btn btn-primary" style="padding: 1rem 3rem; font-size: 1.1rem;">
                    <i class="fas fa-chart-line"></i> Analyze Risk
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Model Information -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title"><i class="fas fa-info-circle"></i> About the EDL System</h3>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: var(--primary-color);"><i class="fas fa-brain"></i> Ensemble Deep Learning</h4>
            <p>Our system combines three advanced neural networks:</p>
            <ul>
                <li><strong>ANN (Artificial Neural Network):</strong> Multi-layer feedforward network</li>
                <li><strong>LSTM (Long Short-Term Memory):</strong> Sequential pattern recognition</li>
                <li><strong>CNN (Convolutional Neural Network):</strong> Feature pattern extraction</li>
            </ul>
            <p>These models work together through <strong>meta-level stacking</strong> to achieve superior accuracy.</p>
        </div>
        
        <div>
            <h4 style="color: var(--primary-color);"><i class="fas fa-award"></i> Clinical Performance</h4>
            <div style="background: #f0f9f0; padding: 1rem; border-radius: 8px;">
                <strong>DDFH Model Results:</strong><br>
                • <strong>98.82%</strong> Test Accuracy<br>
                • <strong>99.41%</strong> Specificity<br>
                • <strong>98.82%</strong> Sensitivity<br>
                • <strong>98.25%</strong> Matthews Correlation Coefficient
            </div>
            <p style="margin-top: 1rem;">Validated on clinical datasets with medical-grade performance standards.</p>
        </div>
        
        <div>
            <h4 style="color: var(--primary-color);"><i class="fas fa-microscope"></i> Key Features</h4>
            <p><strong>DDFH Model - Most Important:</strong></p>
            <ol>
                <li><strong>HbA1c (34.4%):</strong> Gold standard diabetes marker</li>
                <li><strong>BMI (18.3%):</strong> Obesity-diabetes correlation</li>
                <li><strong>Age (11.4%):</strong> Age-related risk factors</li>
            </ol>
            <p><strong>PIMA Model - Most Important:</strong></p>
            <ol>
                <li><strong>Glucose (24.0%):</strong> Direct diabetes indicator</li>
                <li><strong>Age (14.5%):</strong> Age-related risk</li>
                <li><strong>BMI (14.1%):</strong> Weight-related risk</li>
            </ol>
        </div>
    </div>
</div>

<style>
.model-selector {
    padding: 1rem 1.5rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    min-width: 200px;
}

.model-selector:hover {
    border-color: var(--primary-color);
    background: #f7fafc;
}

.model-selector.active {
    border-color: var(--primary-color);
    background: linear-gradient(135deg, #ebf8ff, #bee3f8);
    color: var(--primary-color);
    font-weight: bold;
}

.model-selector small {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.8rem;
    opacity: 0.8;
}

.prediction-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.form-control {
    padding: 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.btn {
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color), #3182ce);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
}

.btn-secondary {
    background: #718096;
    color: white;
}
</style>

<script>
function showModel(modelType) {
    // Hide all forms
    document.querySelectorAll('.model-form').forEach(form => {
        form.style.display = 'none';
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.model-selector').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected form and activate button
    document.getElementById(modelType + '-form').style.display = 'block';
    document.getElementById(modelType + '-btn').classList.add('active');
}

// BMI Calculator Helper
function calculateBMI() {
    const height = prompt("Enter your height in cm:");
    const weight = prompt("Enter your weight in kg:");
    
    if (height && weight) {
        const heightM = height / 100;
        const bmi = weight / (heightM * heightM);
        
        // Set BMI in both forms
        const bmiFields = document.querySelectorAll('input[name="bmi"]');
        bmiFields.forEach(field => {
            field.value = bmi.toFixed(1);
        });
        
        alert(`Your BMI is ${bmi.toFixed(1)}`);
    }
}

// Add BMI calculator buttons
document.addEventListener('DOMContentLoaded', function() {
    const bmiFields = document.querySelectorAll('input[name="bmi"]');
    
    bmiFields.forEach(field => {
        const helpButton = document.createElement('button');
        helpButton.type = 'button';
        helpButton.className = 'btn btn-secondary';
        helpButton.style.marginTop = '0.5rem';
        helpButton.innerHTML = '<i class="fas fa-calculator"></i> Calculate BMI';
        helpButton.onclick = calculateBMI;
        
        field.parentNode.appendChild(helpButton);
    });
});

// Form validation and user experience improvements
document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function(e) {
        const button = form.querySelector('button[type="submit"]');
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
        button.disabled = true;
    });
});
</script>
{% endblock %}